name: Projeto Terraform Azure
on: 
  push:
    branches:
      - main
permissions:
  id-token: write
  contents: read

env: 
  client_id: "${{ secrets.CLIENT_ID }}"
  subscription_id: "${{ secrets.SUBS_ID }}"
  tenant_id: "${{ secrets.TENANTID }}" 

jobs:
  terraform:
    runs-on: ubuntu-latest   
    defaults:
      run:
        working-directory: .
    steps:
      - name: Cache
        uses: actions/cache@v3.3.2
      - name: HashiCorp - Setup Terraform
        uses: hashicorp/setup-terraform@v2.0.3
      - name: Iniciando Terraform
        run: terraform init 
      - name: Planejando Terraform
        run: terraform plan        
      - name: Aplicando Terraform
        run: terraform apply -auto-approve        
      - name: Destruindo Terraform
        run: terraform destroy -auto-approve
